<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<link rel="stylesheet" type="text/css" href="style.css">
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="http://d3js.org/topojson.v1.min.js"></script>
<script src="http://d3js.org/queue.v1.min.js"></script>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/lodash.js/0.10.0/lodash.min.js"></script>

<script src="chord.js"></script>
</head>
<body>
<h1> InfoViz - Personal Project <h1>
<h2> Yi-Yin Wang </h2>
<p>Built with <a href="http://d3js.org/">d3.js</a>.</aside>

<FORM> 
<INPUT TYPE="Button" value="Reset" onclick="recolor('black')"/> 
<INPUT TYPE="Button" value="Map population to color" onclick="recolorByPopulation()"/> 
<INPUT TYPE="Button" value="Map population to size" onclick="reSizeByPopulation()"/> 
<INPUT TYPE="Button" value="Map population to color+size" onclick="changeBothByPopulation()"/> 
</FORM> 
<script type="text/javascript">




																			// TODO: load my data
var matrix = [
  [11975,  5871, 8916, 2868],
  [ 1951, 10048, 2060, 6171],
  [ 8010, 16145, 8090, 8045],
  [ 1013,   990,  940, 6907]
];

var matrix = [[19, 0, 6, 5, 51, 21, 4, 0, 65, 74, 0, 0, 43, 4, 1, 0, 33, 4, 1, 7, 3, 38, 12, 5, 13, 0, 3, 9, 5, 3, 6, 39, 116, 0, 22, 6, 3, 19, 6, 16, 0, 39, 111, 0, 2, 64, 6, 0, 5, 1, 1, 0, 0], [8, 19049, 11, 0, 44, 15, 0, 0, 14, 3, 15, 0, 34, 9, 0, 0, 27, 0, 0, 2, 5, 1, 19, 0, 1, 0, 5, 7, 0, 2, 0, 7, 1, 1, 0, 0, 9, 2, 0, 7, 0, 7, 23, 6, 0, 0, 125, 0, 0, 0, 0, 8, 0], [6, 11, 322, 14, 618, 166, 12, 0, 133, 33, 41, 30, 108, 59, 37, 34, 35, 31, 0, 26, 35, 64, 107, 5, 67, 42, 64, 135, 5, 24, 71, 81, 33, 59, 53, 37, 73, 50, 8, 8, 26, 41, 383, 83, 0, 40, 138, 0, 75, 4, 12, 1, 0], [6, 0, 12, 18, 49, 37, 3, 0, 42, 42, 0, 3, 53, 2, 0, 5, 31, 15, 0, 7, 1, 24, 10, 8, 27, 0, 3, 14, 2, 9, 5, 17, 39, 0, 11, 6, 2, 8, 1, 22, 0, 27, 139, 6, 0, 14, 4, 0, 1, 0, 1, 0, 0], [41, 55, 610, 50, 1855, 422, 53, 0, 632, 155, 363, 111, 249, 135, 70, 26, 165, 96, 8, 113, 184, 150, 197, 6, 208, 58, 67, 369, 25, 164, 113, 350, 132, 5, 157, 134, 378, 259, 27, 62, 4, 171, 929, 307, 0, 259, 424, 0, 70, 20, 25, 6, 0], [24, 16, 169, 40, 391, 347, 14, 7, 179, 74, 30, 47, 138, 40, 68, 49, 69, 48, 4, 19, 23, 81, 79, 4, 105, 104, 112, 87, 7, 29, 83, 99, 34, 84, 98, 76, 63, 55, 10, 12, 65, 78, 392, 112, 0, 61, 100, 0, 56, 96, 7, 0, 0], [11, 0, 11, 0, 51, 13, 7, 0, 133, 34, 1, 0, 64, 21, 1, 0, 37, 11, 3, 9, 21, 41, 29, 0, 22, 0, 7, 12, 7, 35, 3, 54, 60, 2, 40, 0, 5, 61, 9, 11, 0, 36, 50, 7, 2, 91, 13, 0, 5, 0, 12, 0, 1], [0, 0, 0, 0, 0, 7, 0, 2, 21, 4, 0, 0, 7, 0, 0, 0, 0, 0, 0, 0, 0, 4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0], [64, 11, 141, 37, 676, 168, 151, 21, 1073, 374, 25, 13, 408, 221, 85, 15, 284, 116, 77, 170, 230, 290, 173, 79, 197, 16, 46, 142, 53, 286, 31, 906, 456, 34, 395, 85, 70, 394, 96, 105, 19, 323, 673, 55, 22, 488, 120, 28, 80, 2, 142, 0, 28], [74, 2, 34, 54, 151, 71, 39, 4, 335, 157, 15, 3, 143, 82, 33, 15, 119, 87, 16, 32, 46, 103, 33, 91, 66, 11, 22, 35, 20, 62, 13, 221, 208, 9, 119, 54, 29, 165, 25, 83, 11, 133, 257, 13, 12, 215, 31, 26, 76, 5, 16, 1, 7], [0, 19, 44, 0, 373, 28, 0, 0, 3, 7, 726, 3, 19, 1, 0, 0, 1, 6, 0, 11, 18, 0, 13, 0, 0, 0, 0, 35, 0, 22, 0, 12, 0, 0, 11, 0, 38, 6, 0, 0, 0, 7, 33, 7, 0, 21, 85, 0, 0, 0, 0, 43, 0], [0, 0, 35, 0, 110, 42, 0, 0, 16, 4, 5, 29, 28, 4, 3, 2, 5, 5, 0, 4, 4, 7, 18, 0, 19, 1, 0, 24, 0, 3, 6, 3, 3, 0, 13, 2, 12, 12, 0, 0, 1, 9, 19, 110, 0, 2, 46, 0, 0, 8, 0, 0, 0], [47, 29, 112, 45, 230, 139, 71, 10, 424, 145, 29, 31, 237, 121, 134, 54, 173, 60, 25, 65, 58, 320, 204, 34, 194, 20, 78, 74, 30, 85, 28, 334, 143, 23, 195, 102, 37, 208, 28, 71, 34, 135, 298, 47, 21, 226, 52, 7, 149, 11, 34, 0, 7], [6, 7, 57, 2, 136, 43, 20, 0, 202, 92, 0, 2, 129, 45, 24, 3, 39, 18, 11, 18, 31, 124, 78, 21, 63, 0, 19, 26, 11, 32, 3, 95, 109, 0, 56, 7, 15, 79, 12, 35, 0, 74, 143, 13, 8, 102, 19, 7, 27, 0, 9, 0, 0], [0, 2, 43, 0, 74, 70, 2, 0, 78, 32, 0, 11, 140, 15, 30, 2, 24, 1, 2, 5, 4, 34, 26, 2, 12, 1, 4, 31, 0, 14, 0, 15, 15, 2, 13, 4, 5, 9, 2, 12, 0, 28, 55, 5, 1, 20, 13, 1, 10, 1, 1, 0, 0], [2, 0, 35, 0, 35, 58, 0, 0, 11, 14, 0, 1, 55, 3, 4, 24, 9, 2, 0, 2, 1, 3, 17, 5, 31, 9, 2, 20, 0, 3, 1, 4, 2, 0, 4, 5, 2, 10, 1, 7, 0, 10, 97, 8, 0, 4, 13, 5, 1, 2, 0, 0, 0], [29, 28, 32, 34, 159, 66, 38, 1, 268, 102, 7, 4, 181, 31, 17, 6, 33, 38, 2, 51, 42, 152, 76, 26, 107, 7, 16, 26, 19, 77, 13, 183, 172, 2, 61, 22, 12, 136, 11, 44, 7, 96, 234, 21, 8, 155, 22, 1, 38, 0, 11, 0, 0], [20, 1, 31, 6, 108, 49, 13, 0, 92, 86, 0, 5, 61, 21, 1, 3, 38, 18, 11, 22, 24, 42, 39, 20, 26, 0, 7, 30, 5, 41, 8, 97, 60, 0, 48, 21, 10, 62, 13, 15, 0, 60, 336, 19, 0, 66, 17, 2, 10, 0, 5, 0, 0], [0, 0, 1, 0, 2, 0, 2, 0, 90, 21, 0, 2, 27, 10, 0, 0, 0, 6, 30, 9, 61, 47, 2, 0, 11, 0, 0, 3, 4, 32, 1, 100, 21, 0, 21, 0, 0, 54, 1, 5, 0, 10, 11, 0, 8, 65, 2, 0, 0, 0, 0, 0, 0], [8, 1, 26, 7, 112, 20, 12, 0, 155, 25, 6, 9, 56, 27, 7, 8, 35, 11, 16, 16, 35, 47, 30, 5, 27, 5, 4, 36, 8, 43, 8, 87, 81, 0, 54, 16, 13, 64, 7, 29, 0, 35, 101, 20, 4, 52, 23, 0, 8, 1, 8, 0, 7], [0, 4, 26, 1, 186, 31, 26, 1, 237, 50, 17, 4, 60, 37, 0, 2, 40, 29, 53, 23, 234, 54, 39, 2, 24, 2, 6, 43, 15, 117, 7, 252, 69, 0, 82, 5, 24, 100, 28, 36, 0, 21, 113, 15, 12, 98, 29, 2, 10, 0, 17, 0, 6], [50, 11, 71, 25, 144, 85, 41, 4, 294, 95, 1, 7, 335, 123, 33, 1, 161, 46, 43, 51, 54, 432, 152, 26, 127, 2, 33, 65, 29, 80, 6, 275, 173, 1, 166, 42, 14, 174, 24, 96, 1, 140, 277, 16, 11, 199, 19, 9, 181, 0, 13, 0, 0], [11, 12, 112, 10, 192, 74, 30, 0, 169, 32, 15, 18, 206, 76, 30, 18, 67, 32, 7, 30, 39, 149, 154, 8, 90, 77, 53, 50, 3, 47, 12, 147, 92, 119, 101, 37, 9, 105, 14, 7, 76, 96, 211, 26, 3, 101, 62, 0, 156, 7, 14, 0, 3], [3, 0, 2, 7, 14, 2, 0, 0, 76, 98, 0, 0, 33, 21, 2, 4, 21, 22, 2, 6, 2, 24, 9, 33, 13, 0, 2, 5, 2, 6, 3, 17, 78, 0, 43, 11, 0, 19, 2, 27, 0, 27, 95, 0, 0, 29, 0, 1, 15, 0, 0, 0, 0], [13, 1, 73, 25, 221, 107, 16, 0, 183, 59, 1, 11, 202, 32, 14, 28, 106, 35, 16, 21, 26, 114, 84, 14, 99, 2, 17, 41, 19, 52, 16, 148, 113, 0, 77, 33, 19, 90, 21, 28, 0, 64, 215, 54, 5, 137, 49, 1, 17, 1, 16, 0, 1], [0, 0, 42, 0, 50, 106, 0, 0, 13, 11, 0, 7, 26, 0, 8, 1, 7, 0, 0, 2, 5, 1, 82, 0, 1, 169, 8, 40, 0, 10, 1, 16, 0, 3, 3, 0, 14, 5, 0, 0, 7, 14, 11, 81, 0, 6, 49, 0, 1, 5, 0, 0, 0], [7, 0, 48, 0, 79, 112, 2, 0, 44, 22, 1, 10, 76, 14, 1, 3, 11, 4, 0, 9, 9, 35, 56, 2, 13, 1, 71, 27, 0, 19, 0, 21, 15, 0, 17, 7, 15, 18, 7, 4, 4, 16, 78, 36, 0, 32, 12, 0, 8, 8, 2, 0, 0], [12, 8, 137, 17, 363, 79, 16, 0, 139, 33, 45, 26, 72, 29, 40, 17, 30, 29, 2, 40, 38, 57, 60, 2, 39, 39, 26, 69, 5, 25, 15, 93, 46, 30, 36, 26, 61, 57, 9, 17, 14, 39, 206, 67, 0, 36, 80, 0, 22, 13, 8, 0, 0], [3, 0, 4, 2, 27, 5, 2, 0, 56, 25, 0, 0, 29, 10, 7, 2, 14, 9, 2, 8, 18, 28, 5, 2, 23, 0, 0, 9, 1, 27, 0, 49, 33, 0, 20, 3, 3, 45, 1, 12, 2, 14, 21, 0, 1, 27, 6, 0, 2, 0, 1, 0, 0], [4, 17, 24, 10, 151, 39, 27, 1, 297, 64, 26, 0, 88, 38, 20, 1, 71, 45, 28, 44, 111, 78, 49, 5, 49, 9, 20, 18, 27, 5, 10, 203, 129, 0, 113, 23, 14, 109, 48, 55, 1, 61, 124, 20, 18, 156, 25, 10, 26, 4, 23, 0, 7], [3, 0, 67, 1, 118, 84, 6, 0, 31, 13, 0, 4, 31, 7, 2, 2, 12, 6, 0, 8, 8, 2, 15, 0, 18, 0, 0, 17, 4, 5, 102, 23, 4, 0, 10, 20, 8, 12, 3, 4, 0, 10, 130, 24, 0, 13, 10, 0, 5, 0, 2, 0, 1], [49, 3, 77, 24, 392, 100, 34, 3, 892, 194, 22, 2, 306, 103, 15, 12, 185, 113, 89, 89, 249, 296, 144, 14, 152, 6, 29, 103, 68, 205, 19, 589, 449, 1, 248, 18, 47, 395, 15, 181, 0, 201, 309, 38, 53, 524, 64, 3, 64, 3, 62, 0, 17], [84, 1, 33, 30, 124, 30, 59, 3, 453, 220, 2, 2, 151, 118, 20, 1, 176, 59, 25, 77, 86, 169, 94, 83, 99, 0, 14, 31, 28, 133, 9, 450, 482, 1, 213, 13, 17, 293, 43, 156, 1, 217, 192, 26, 11, 410, 30, 29, 36, 0, 23, 0, 12], [2, 0, 61, 0, 4, 86, 0, 0, 34, 7, 0, 0, 23, 0, 1, 1, 1, 0, 0, 0, 0, 4, 109, 0, 5, 0, 0, 29, 0, 0, 0, 0, 1, 105, 2, 0, 0, 2, 0, 0, 9, 8, 11, 23, 0, 0, 1, 0, 2, 0, 0, 0, 0], [24, 6, 61, 21, 155, 93, 35, 0, 450, 120, 16, 11, 216, 57, 11, 10, 71, 43, 12, 62, 61, 155, 98, 37, 81, 2, 13, 43, 29, 116, 11, 256, 195, 1, 100, 17, 10, 156, 21, 56, 0, 81, 224, 6, 14, 205, 29, 17, 40, 0, 10, 0, 1], [7, 0, 38, 19, 107, 73, 8, 0, 97, 52, 0, 8, 103, 7, 2, 8, 14, 17, 0, 15, 8, 39, 30, 8, 32, 0, 7, 22, 4, 21, 11, 12, 12, 0, 20, 28, 10, 11, 4, 6, 2, 25, 186, 27, 0, 43, 15, 5, 9, 0, 1, 0, 0], [0, 17, 76, 4, 383, 65, 6, 0, 45, 22, 39, 17, 38, 14, 10, 1, 12, 15, 0, 12, 23, 16, 16, 1, 18, 14, 6, 59, 5, 11, 7, 40, 20, 0, 9, 7, 507, 30, 3, 0, 0, 11, 79, 54, 0, 51, 107, 0, 10, 1, 0, 3, 0], [25, 1, 45, 11, 256, 64, 58, 0, 384, 170, 13, 9, 221, 87, 10, 3, 137, 68, 39, 62, 89, 168, 99, 19, 84, 2, 18, 49, 37, 123, 10, 433, 266, 3, 169, 17, 24, 314, 40, 110, 0, 125, 231, 31, 33, 259, 42, 6, 29, 3, 16, 0, 8], [4, 0, 10, 0, 35, 11, 9, 0, 96, 25, 0, 0, 24, 18, 0, 1, 7, 15, 1, 9, 26, 41, 15, 2, 21, 0, 1, 9, 2, 39, 2, 21, 41, 0, 29, 3, 2, 39, 20, 11, 0, 19, 32, 4, 0, 55, 8, 0, 5, 0, 4, 0, 0], [26, 3, 4, 9, 63, 8, 15, 0, 106, 77, 0, 0, 73, 39, 4, 10, 77, 6, 8, 29, 40, 88, 8, 22, 46, 0, 6, 13, 11, 58, 2, 154, 159, 0, 72, 10, 3, 95, 5, 20, 0, 65, 110, 3, 7, 157, 16, 8, 10, 0, 1, 0, 0], [0, 1, 26, 1, 2, 67, 0, 0, 18, 11, 0, 0, 32, 1, 2, 1, 8, 0, 0, 0, 0, 1, 79, 0, 0, 0, 4, 14, 0, 0, 0, 0, 0, 7, 2, 2, 0, 0, 0, 0, 82, 8, 30, 11, 0, 0, 2, 0, 0, 5, 0, 0, 0], [30, 8, 40, 29, 166, 76, 32, 0, 283, 151, 7, 10, 131, 88, 24, 12, 104, 65, 9, 29, 20, 163, 86, 34, 66, 14, 12, 40, 23, 66, 14, 193, 204, 9, 95, 32, 16, 137, 28, 86, 7, 119, 279, 33, 3, 166, 22, 16, 28, 7, 15, 0, 0], [115, 22, 340, 141, 906, 371, 71, 1, 633, 209, 69, 25, 294, 171, 51, 113, 233, 300, 5, 104, 111, 329, 213, 109, 232, 15, 87, 194, 27, 139, 126, 309, 192, 10, 204, 207, 71, 229, 28, 107, 27, 270, 2063, 201, 0, 262, 152, 23, 85, 13, 35, 6, 4], [3, 5, 70, 1, 314, 104, 7, 0, 54, 18, 16, 113, 44, 20, 3, 7, 24, 11, 0, 17, 15, 15, 23, 2, 55, 78, 37, 84, 3, 19, 20, 37, 25, 21, 15, 23, 54, 28, 1, 2, 12, 31, 196, 70, 0, 20, 85, 0, 26, 59, 0, 0, 0], [2, 0, 0, 0, 0, 0, 1, 0, 16, 13, 0, 0, 24, 8, 0, 0, 2, 7, 10, 4, 14, 22, 3, 0, 2, 0, 0, 0, 0, 17, 0, 47, 7, 0, 13, 0, 0, 32, 1, 8, 0, 7, 7, 0, 0, 48, 0, 0, 1, 0, 0, 0, 0], [68, 6, 45, 14, 230, 64, 75, 1, 467, 204, 33, 6, 204, 100, 26, 3, 169, 74, 63, 42, 94, 197, 108, 33, 122, 9, 32, 53, 28, 153, 17, 525, 399, 0, 245, 50, 40, 280, 57, 135, 2, 194, 272, 24, 47, 366, 35, 52, 54, 5, 22, 0, 7], [5, 134, 130, 3, 414, 92, 9, 0, 101, 31, 85, 46, 55, 21, 10, 9, 29, 15, 0, 22, 32, 29, 58, 2, 42, 54, 25, 82, 8, 25, 10, 54, 24, 2, 25, 5, 114, 52, 5, 14, 5, 29, 144, 85, 0, 35, 818, 0, 15, 4, 3, 0, 0], [0, 0, 0, 0, 1, 0, 0, 0, 28, 26, 0, 0, 8, 8, 2, 6, 7, 2, 0, 0, 1, 8, 0, 1, 0, 0, 0, 0, 0, 8, 0, 3, 30, 1, 10, 3, 0, 4, 0, 9, 0, 19, 22, 0, 0, 60, 0, 14, 0, 0, 0, 0, 0], [6, 0, 77, 3, 64, 52, 0, 0, 74, 62, 0, 4, 165, 30, 3, 0, 40, 11, 0, 10, 20, 171, 174, 20, 18, 0, 6, 28, 0, 24, 4, 69, 29, 0, 50, 4, 6, 26, 3, 20, 1, 36, 72, 37, 0, 53, 7, 0, 77, 0, 1, 0, 0], [0, 0, 4, 0, 20, 101, 0, 0, 2, 5, 0, 7, 10, 0, 0, 0, 0, 0, 0, 2, 2, 0, 7, 0, 1, 0, 9, 11, 0, 3, 0, 7, 0, 0, 0, 0, 2, 2, 0, 0, 1, 8, 13, 58, 0, 0, 4, 0, 0, 60, 0, 0, 0], [1, 0, 10, 1, 26, 13, 15, 0, 136, 15, 0, 2, 30, 13, 1, 0, 15, 5, 0, 8, 15, 12, 10, 0, 14, 0, 5, 12, 2, 25, 1, 56, 14, 0, 12, 0, 2, 20, 2, 1, 0, 19, 37, 2, 0, 21, 4, 0, 5, 3, 148, 0, 74], [0, 4, 0, 0, 3, 0, 0, 0, 0, 0, 34, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 6, 0, 0, 0, 0, 0, 0, 0, 0, 109, 0], [0, 0, 2, 0, 9, 5, 0, 0, 33, 8, 0, 0, 7, 0, 0, 0, 0, 0, 0, 0, 12, 1, 2, 0, 0, 0, 3, 6, 0, 7, 1, 16, 11, 0, 2, 0, 2, 7, 0, 0, 0, 0, 7, 0, 0, 10, 0, 0, 0, 0, 74, 0, 63]]

var chord = d3.layout.chord()
    .padding(.05)
    .sortSubgroups(d3.descending)
    .matrix(matrix);  //set the input data

var width = 960,
    height = 500,
    innerRadius = Math.min(width, height) * .41,
    outerRadius = innerRadius * 1.1;

var fill = d3.scale.ordinal()
    .domain(d3.range(4)) 													//TODO: scale for states
    .range(["#000000", "#FFDD89", "#957244", "#F26223"]);  					//TODO: color choice

var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height)
  	.append("g")
    .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

svg.append("g").selectAll("path")
    .data(chord.groups)
  	.enter().append("path")
    .style("fill", function(d) { return fill(d.index); })
    .style("stroke", function(d) { return fill(d.index); })
    .attr("d", d3.svg.arc().innerRadius(innerRadius).outerRadius(outerRadius))
    .on("mouseover", fade(.1))
    .on("mouseout", fade(1));

var ticks = svg.append("g").selectAll("g")
    .data(chord.groups)
  .enter().append("g").selectAll("g")
    .data(groupTicks)
  .enter().append("g")
    .attr("transform", function(d) {
      return "rotate(" + (d.angle * 180 / Math.PI - 90) + ")"
          + "translate(" + outerRadius + ",0)";
    });

ticks.append("line")
    .attr("x1", 1)
    .attr("y1", 0)
    .attr("x2", 5)
    .attr("y2", 0)
    .style("stroke", "#000");

ticks.append("text")
    .attr("x", 8)
    .attr("dy", ".35em")
    .attr("transform", function(d) { return d.angle > Math.PI ? "rotate(180)translate(-16)" : null; })
    .style("text-anchor", function(d) { return d.angle > Math.PI ? "end" : null; })
    .text(function(d) { return d.label; }); //TODO: change label

svg.append("g")
    .attr("class", "chord")
  	.selectAll("path")
    .data(chord.chords)
  	.enter().append("path")
    .attr("d", d3.svg.chord().radius(innerRadius))
    .style("fill", function(d) { return fill(d.target.index); })
    .style("opacity", 1);

// Returns an array of tick angles and labels, given a group.
function groupTicks(d) {
  var k = (d.endAngle - d.startAngle) / d.value;
  return d3.range(0, d.value, 1000).map(function(v, i) {
    return {
      angle: v * k + d.startAngle,
      label: i % 5 ? null : v / 1000 + "k"
    };
  });
}

// Returns an event handler for fading a given chord group.
function fade(opacity) {
  return function(g, i) {
    svg.selectAll(".chord path")
        .filter(function(d) { return d.source.index != i && d.target.index != i; })
      .transition()
        .style("opacity", opacity);
  };
}




// Create flight data
var flights = [];
d3.json('data/flight.json', function (error, data) {
		console.log("loading json");
		console.log(error);
		console.log(data);
        $.each(data, function(index, origin) {
        	var origState = []
    		$.each(origin, function(idx,destination){
    			origState.push(destination.flight);
    		});
    		console.log(origState);
    		flights.push(origState);
		});

       
        //drawChords(mpr.getMatrix(), mpr.getMap());
      });
console.log(flights)

	/*******************************************************************
      //  DRAW THE CHORD DIAGRAM
      //*******************************************************************/
      function drawChords (matrix, mmap) {
        var w = 980, h = 800, r1 = h / 2, r0 = r1 - 100;

        var fill = d3.scale.ordinal()
            .range(['#c7b570','#c6cdc7','#335c64','#768935','#507282','#5c4a56','#aa7455','#574109','#837722','#73342d','#0a5564','#9c8f57','#7895a4','#4a5456','#b0a690','#0a3542',]);

        var chord = d3.layout.chord()
            .padding(.02)
            .sortSubgroups(d3.descending)

        var arc = d3.svg.arc()
            .innerRadius(r0)
            .outerRadius(r0 + 20);

        var svg = d3.select("body").append("svg:svg")
            .attr("width", w)
            .attr("height", h)
          .append("svg:g")
            .attr("id", "circle")
            .attr("transform", "translate(" + w / 2 + "," + h / 2 + ")");

            svg.append("circle")
                .attr("r", r0 + 20);

        var rdr = chordRdr(matrix, mmap);
        chord.matrix(matrix);

        var g = svg.selectAll("g.group")
            .data(chord.groups())
          .enter().append("svg:g")
            .attr("class", "group")
            .on("mouseover", mouseover)
            .on("mouseout", function (d) { d3.select("#tooltip").style("visibility", "hidden") });

        g.append("svg:path")
            .style("stroke", "black")
            .style("fill", function(d) { return rdr(d).gdata == "state" ? "black": "grey"; })
            .attr("d", arc);

        g.append("svg:text")
            .each(function(d) { d.angle = (d.startAngle + d.endAngle) / 2; })
            .attr("dy", ".35em")
            .style("font-family", "helvetica, arial, sans-serif")
            .style("font-size", "10px")
            .attr("text-anchor", function(d) { return d.angle > Math.PI ? "end" : null; })
            .attr("transform", function(d) {
              return "rotate(" + (d.angle * 180 / Math.PI - 90) + ")"
                  + "translate(" + (r0 + 26) + ")"
                  + (d.angle > Math.PI ? "rotate(180)" : "");
            })
            .text(function(d) { return rdr(d).gname; });

          var chordPaths = svg.selectAll("path.chord")
                .data(chord.chords())
              .enter().append("svg:path")
                .attr("class", "chord")
                .style("stroke", "black")
                .style("fill", function(d) { return rdr(d).tname == "Starbucks" ? "#00592d": "#ff6200"; })
                .attr("d", d3.svg.chord().radius(r0))
                .on("mouseover", function (d) {
                  d3.select("#tooltip")
                    .style("visibility", "visible")
                    .html(chordTip(rdr(d)))
                    .style("top", function () { return (d3.event.pageY - 170)+"px"})
                    .style("left", function () { return (d3.event.pageX - 100)+"px";})
                })
                .on("mouseout", function (d) { d3.select("#tooltip").style("visibility", "hidden") });

          function chordTip (d) {
            var p = d3.format(".1%"), q = d3.format(",f")
            return "Chord Info:<br/>"
              +  d.sname + " → " + d.tname
              + ": " + q(d.svalue) + "<br/>"
              + p(d.svalue/d.stotal) + " of " + d.sname + "'s Total (" + q(d.stotal) + ")<br/>"
              + p(d.svalue/(d.mtotal/2)) + " of Matrix Total (" + q(d.mtotal/2) + ")<br/>"
              + "<br/>"
              + d.tname + " → " + d.sname
              + ": " + q(d.tvalue) + "<br/>"
              + p(d.tvalue/d.ttotal) + " of " + d.tname + "'s Total (" + q(d.ttotal) + ")<br/>"
              + p(d.tvalue/(d.mtotal/2)) + " of Matrix Total (" + q(d.mtotal/2) + ")";
          }

          function groupTip (d) {
            var p = d3.format(".1%"), q = d3.format(",f")
            return "Group Info:<br/>"
                + d.gname + " : " + q(d.gvalue) + "<br/>"
                + p(d.gvalue/(d.mtotal/2)) + " of Matrix Total (" + q(d.mtotal/2) + ")"
          }

          function mouseover(d, i) {

            d3.select("#tooltip")
              .style("visibility", "visible")
              .html(groupTip(rdr(d)))
              .style("top", function () { return (d3.event.pageY - 80)+"px"})
              .style("left", function () { return (d3.event.pageX - 130)+"px";})

            chordPaths.classed("fade", function(p) {
              return p.source.index != i
                  && p.target.index != i;
            });
          }
        }
</script>

<body>
</html>